using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using System.Net;
using System.Net.Security;
using System.Security.Cryptography.X509Certificates;
using System.Text;
using System.Threading.Tasks;

namespace RankChanger
{
    class ClientApi
    {
        private string Password;
        private int Port;
        private string Protocol = "https";
        public ClientApi(string password, int port, string protocol = "https")
        {
            ServicePointManager.ServerCertificateValidationCallback = delegate (
                  Object obj, X509Certificate certificate, X509Chain chain,
                  SslPolicyErrors errors)
            {
                return (true);
            };
            this.Password = password;
            this.Port = port;
            this.Protocol = protocol;
        }
        public bool UpdateRanking(string rank)
        {
            string content = "{\"lol\": {\"rankedLeagueTier\": \"" + rank + "\"}}";
            byte[] data = Encoding.UTF8.GetBytes(content);
            try
            {
                HttpWebRequest req = WebRequest.CreateHttp($"{this.Protocol}://127.0.0.1:{this.Port}/lol-chat/v1/me");
                req.Method = "PUT";
                req.Accept = "*/*";
                req.ContentType = "application/json";
                req.Headers.Add("Authorization", "Basic " + Convert.ToBase64String(Encoding.UTF8.GetBytes($"riot:{this.Password}")));
                req.ContentLength = data.Length;
                using (var stream = req.GetRequestStream())
                {
                    stream.Write(data, 0, data.Length);
                }
                HttpWebResponse res = (HttpWebResponse)req.GetResponse();
                StreamReader sr = new StreamReader(res.GetResponseStream());
                return true;
            }
            catch (Exception ex)
            {
                Console.WriteLine(ex.ToString());
                return false;
            }
        }
    }
}
